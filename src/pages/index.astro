---
import BaseLayout from "../layouts/BaseLayout.astro";
import { loadPublications } from "../lib/publications";
import { getEntryBySlug } from "astro:content";

/* ABOUT (Content Collection) */
const aboutEntry = await getEntryBySlug("pages", "about");

if (!aboutEntry) {
  throw new Error("About page not found in content collection");
}

/* Render Markdown → Astro component */
const { Content: AboutContent } = await aboutEntry.render();

/* Publicações */
const { journals, conferences } = loadPublications();

/* Meta tags acadêmicas */
const citation = [...journals, ...conferences];
---

<BaseLayout title="Dr. Marcos Hideo Maruo" citation={citation}>

  <!-- ABOUT -->
  <section id="about">
    <h2>{aboutEntry.data.title}</h2>
    <AboutContent />
  </section>

  <!-- PUBLICATIONS -->
  <section id="publications">
    <h2>Publications</h2>

    <h3>Journal Articles</h3>
    <ul>
      {journals.map(p => (
        <li>
          <strong>{p.title}</strong><br />
          {p.author}<br />
          {p.journal && <em>{p.journal}</em>}
          {p.year && `, ${p.year}`}<br />
          {p.doi && (
            <a href={`https://doi.org/${p.doi}`} target="_blank" rel="noopener">
              DOI
            </a>
          )}
          {" · "}
          <a href={`/bib/${p._key}.bib`}>BibTeX</a>
        </li>
      ))}
    </ul>

    <h3>Conference Articles</h3>
    <ul>
      {conferences.map(p => (
        <li>
          <strong>{p.title}</strong><br />
          {p.author}<br />
          {p.booktitle && <em>{p.booktitle}</em>}
          {p.year && `, ${p.year}`}<br />
          {p.doi && (
            <a href={`https://doi.org/${p.doi}`} target="_blank" rel="noopener">
              DOI
            </a>
          )}
          {" · "}
          <a href={`/bib/${p._key}.bib`}>BibTeX</a>
        </li>
      ))}
    </ul>
  </section>

</BaseLayout>

